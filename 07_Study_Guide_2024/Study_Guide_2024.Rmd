---
title: "Statistics -- Study Guide"
author: "EA 30 Spring 2024"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Document History

### Round One

Each group will write two questions (and answers). Then at the top of each section, write out a short study guide that might include useful functions to understand, a link to a video, or “psuedo” code that might help.


- Group 1: 1a and 8b -- Creating Vectors
- Group 2: 2a and 7b -- Creating Dataframe in R
- Group 3: 3a and 6 -- Summary Statistics
- Group 4: 4a and 5b -- ANOVA
- Group 5: 5a and 3b -- T-Tests
- Group 6: 6a and 4b -- Correlation/Linear Regression
- Group 7: 7a and 1b -- Contingency Tables/Tests for Association
- Group 8: 8a and 2b -- Logistic Regression

Here's a [link to the google doc](https://docs.google.com/document/d/1aYsL29_yqikCuEjdDfPjcGZ2Om4mMJRX6ca9BoSVIFI/edit#heading=h.hgp5u648b92o)

## Round Two

![Data Analysis Flow Chart](Leek_DataAnalysisFlowChart.png)

New Groups: 

- Group 1: vectors and test for association (contingency tables)
- Group 2: dataframes and logistic regression
- Group 3: summary statistics (and a probability distribution function image)
- Group 4: ANOVA and boxplots and causuality
- Group 5: t-tests and histograms
- Group 6: linear regression and correlation (what's the difference)


1. Copy Rmd into Rstudio and knit and make sure it works.


2. For each section, we would like our peers to have some background on topic and why the information is useful. If you link to a video, please describe what the viewer is going to learn.

3.  Adjust your question to make it align with the course content. Change the examples to environmental data types. All datasets should have an EA theme. 

4. Use vectors and data frames in problem sets as much as possible. 

5. Make sure the code works and generates an output. The guide should work!

6. Provide some help to reader to interpret results.

7. Add questions that addresses the flow chart above -- ask the reader to consider what type of analysis it might be and why!

8. Cut the sections of the Rmd that you are not working on and when you are done (don't cut the preamble stuff). 

9. please submit a working Rmd file on today's canvas assignment and change the folks in your group in the "author" in the Rmd file.

## Round Three: 

### Marc's Synthesis

1. I combined each submission, tricky since some didn't cut out the sections they didn't work on, so I had to compare line-by-line. Must be a better way!

2. I formatted each section so I could a "stand alone" lesson that I will make into a video during the week of the 21st of April.

### Videos
3. Created a dozen or so videos so that students have a idea of what to do for their pilot project analyses.

### Peer Evaluation

4. Each group will watch a movie and make suggestions to improve content and explanation

Group 1: Section 1, 
Group 2: Section 2
Group 3: Section 3
Group 4: Section 4
Group 5: Section 5
Group 6: Section 6
Group 7: Section 7
Group 8: Section 8

# Working with R

## 1. Vectors

### Q1a. What are vectors and how are they used?

Answer: They are very versatile and can store multiple variables in a single date type.

### Q1b: Create a vector of character values

Step-by-step guide: 
\begin{itemize}
	\item Determine the strings you want to include in your vector.
	\item Use the \texttt{c()} function to combine these strings.
	\item Assign the result to a variable.
	\item Print the variable to see the result.
\end{itemize}

Utilize the c() function to combine character strings into a vector. For example, in this case, we enumerated the number of ant genera in several Claremont parks. 

```{r}
ant_species <- c("Formica", "Camponotus", "Lasius", "Myrmica", "Tetramorium")
set.seed(29330)
ant_vector <- sample(ant_species, 19, replace = TRUE)
```

Let's see what it looks like: 

```{r}
print(ant_vector)
```

### Q1c: Create a vector of tree heights

Tree height can be used to estimate the shading of a park. You have surveyed the tree heights in several open areas in the 5C and will use these to estimate the amount of shade on campus.   

You've surveyed all the trees in your local park and recorded their height, in feet, as follows:  50, 25, 36, 27, 82, 39, 55, 62

```{r}
tree_height <- c(50,25,36,27,82,39,55,62,33)
print(tree_height)
```

In addition, we collected tree height data from a 2nd city park: 

```{r}
tree2_height <- c(60,27,70,29,80,39,40,60)
```

### Q1d. Vector of Rainfall Data

We going to create a vector of random numbers that represent 25 years of rainfall data using a lognormal distribution with the following parameter: mean = 25, sd = 10.

```{r}
set.seed(11144)
rainfall_notrend <- rlnorm(n =25, meanlog = 1.5, sdlog =1); #hist(rainfall)
```

To make the data more interesting, we'll add a trend to the data, where amount goes up by 1% of the mean each year. Note: I should have this amoratized using a loop, but didn't have time to write the code.

```{r}
rainfall_trend <- rainfall_notrend * (1 + seq(0, 0.24, 0.01))
rainfall_trend
```

(1 + seq(0, 0.24, 0.01))
print(rainfall)


## 2. Dataframes in R

Introductory video: [R Tutorial - Using the Data Frame in R](https://www.youtube.com/watch?v=9f2g7RN5N0I)

A data frame is a collection of data in rows and columns
\begin{itemize}
	\item Rows = entries (observations)
	\item Columns = variables (composted of vectors)
\end{itemize}

A dataframe can only store vectors of the same length, you you might get an error, see below.


### Q2a: Creating a Dataframe with Three Treatments: 

Data are use to evaluate compuse maturity from there treatments "A", "B", and "C": We'll select 10 measures from a random normal distribution with various means and a standard deviation of 2 and round to the nearest 0.1. 

```{r}
group1 <- round(rnorm(10, mean = 10, sd = 2), 1)
group2 <- round(rnorm(10, mean = 12, sd = 2), 1)
group3 <- round(rnorm(10, mean = 15, sd = 2), 1)
```

To create the dataframe, we'll need to add the treatments so they are repeated 10 times for each treatment. 


```{r}
compost_data <- data.frame(
  Group = rep(c("A", "B", "C"), each = 10),
  Dependent_Variable = c(group1, group2, group3)
)
```

Show the first few rows of the dataset

```{r}
head(compost_data)
```

We'll look at the summary of the data in Section [Q4b: Using the Summary() function on Compost Maturity Data] and use an ANOVA in Section [Q5a: ANOVA of Compost Maturity Data]

### Q2b. Data Frame with Rainfall

We created 25 years of data using a lognormal distribution and then create a trend in the vector. Now we will create a dataframe with the following columns: Year, Rainfall_Notrend, and Rainfall_Trend.

```{r}
year <- 1995:2019
rainfall.df <- data.frame(year, rainfall_notrend, rainfall_trend)
```

Now let's check the dataframe:

```{r}
str(rainfall.df)
head(rainfall.df)

```
We will analyze this using a [7a Linear Regression of Rainall Data]

### Q2c. Data Frame with Squirrel Reproduction

We have collected data on the weight of ground squirrels and the number of offspring they have. We will create a dataframe with the following columns: Ground_Squirel_ID, Weight, and Off_spring.

```{r}
Ground_Squirrel_ID <- 1:20
Weight <-     c(250, 340, 550, 190, 509, 609, 745, 846, 963, 433, 444, 833, 355, 455, 300,555, 666, 777, 888, 599)
Off_spring <- c(0,     0,   1,   0,   0,   0,   1,   0,   1,   1,   0,   1,   0,   0,   0,  0,  1,    1,  1,    1)

Ground_Squirrel_data <- data.frame(Ground_Squirrel_ID, Weight, Off_spring)
```



## 3. Matrices

Matrices are used to store data in a two- or mult-dimensional format. They are similar to data frames, but all elements must be of the same data type. Once you have created a matrix, you can perform mathematical operations on it, such as addition, subtraction, and multiplication -- following the rules of matrix algebra.

For our purposes, we'll make a matrix of the following data:

\begin{table}
	\centering
		\begin{tabular}{cccc}
	&	Bees & Butterflies & Beetles \\
Vegetable Garden &			1 & 2 & 2 \\
Flower Garden &			15 & 6 & 22\\
Herb Garden	&		7 & 11 & 15 \\
		\end{tabular}
\end{table}	


Step-by-step guide: 
\begin{itemize}
	\item 
\end{itemize}

		
### Q3a: Create a Matrix of Pollinator Data

```{r}
pollinators_type <- c("Bees", "Butterflies", "Beetles")
garden_type <- c("Vegetable garden", "Flower garden", "Herb garden")

pollinator_data = c(1, 2, 2, 15, 6, 22, 9, 11, 15)
# Generate fake data
pollination_matrix = matrix(pollinator_data, nrow = 3, ncol = , byrow=TRUE)

pollination_matrix
```

Sometimes it nice to name the rows and columns to make sure you can keep track of the data.

```{r}
colnames(pollination_matrix) <- garden_type
rownames(pollination_matrix) <- pollinators_type
```


```{r}
pollination_matrix
```

We will use a [Q6a: Fisher Test of Pollinator Data] to analyze this data.

## 4. Summary Statistics

When you want to evaluate a dataset and learn more information about the distribution! It is a helpful first step before undertaking more complex tests on the data . So, what are summary statistics? Check out this 5-minute video: 

Basic summary statistics in R. Pay close attention to the code used to find the mean, median, and standard deviation. 

Role of Summary Statitiscs in Data Analysis

### Q4a: Summary of Categorical Data

The table() function is used to summarize categorical data. It will provide a frequency count of the data.
```{r}
table(ant_data)
```

### Q4b: Using the Summary() function on Compost Maturity Data

Provide some of the summary statistics for this dataset. T

```{r}
summary(compost_data)
```

The summary works well for the dependent variable, but not for the treatment group. We can use the table() function to summarize the treatment group. 

```{r}
table(compost_data$Group)
```
Which tells us that there are 10 observations for each group. Not that interesting. I would rather use str() to get a better idea of the data. 

```{r}
str(compost_data)

```

To get to the summary stats, I prefer using the mean(), median(), and sd() functions. 

### Q4c. Mean, Median, and Standard Devivation

```{r}
mean(compost_data$Dependent_Variable)
median(compost_data$Dependent_Variable)
sd(compost_data$Dependent_Variable)
```
All good, but if you want to look at how these data vary by catogory, then we need to use boxplot() function. See Section [Q8a: Boxplot of Compost Maturity Data]

## 5 Visualing Data, Distributions, and Relationships


### Q5a Histogram of Tree Height Vector

```{r}
hist(tree_height)
```

### Q5b: Double Variable Histogram 

You want to compare tree heights in different nearby parks
You record the tree height at another park as: 60,27,70,29,80,39,40,60

Answer:
```{r}

p1<-hist(tree_height)
p2<-hist(tree2_height)
plot( p1, col=rgb(0,0,1,1/4), xlim=c(0,100))  # first histogram
plot( p2, col=rgb(1,0,0,1/4), xlim=c(0,100), add=TRUE)
```

### Q5c Probabaility Distributions

Instead of using a histogram, we can also use a theoretical probability distribution to represent the data.

In the example below, we used both the normal probability distribution and the lognormal probability distribution. Which one do think models the data better? I suggest you compare thest to a histogram, data from [1d. Vector of Rainfall Data]

```{r}
x= 1:25
x<-seq(from=-5,to=10,length.out=100)
plot(x,dnorm(x), ty='l', col='red')
lines(x,dnorm(x), ty='l', col='blue')
```

### Q5d: Boxplot of Compost Maturity Data

```{r}
boxplot(compost_data$Dependent_Variable ~ compost_data$Group)
```

### Q5e: Scatterplot of Rainfall Data

```{r}
plot(rainfall_notrend ~ year, rainfall.df, col = "blue", ylim=c(0, 50))
points(rainfall_trend ~ year, rainfall.df, col = "red", pch=20)
```

### Q5f: Scatterplot of Ground Squirrel Data

```{r}
plot(Off_spring ~ Weight, data= Ground_Squirrel_data, col="blue", pch=20, las=1)

```

## 6. Tests for Association

Test for association are use to determine if two or more categorical variables are independent.
If we can reject the hypothesis, then we can conclude that there is an association between the variables.


Contingency tables are very useful when we need to condense a large amount of data into a smaller format, to make it easier to gain an overall view of our original data. To create contingency tables in R we will be making use of the table() function.

In statistics, a contingency table (also known as a cross tabulation or crosstab) is a type of table in a matrix format that displays the multivariate frequency distribution of the variables.

-- What kind of variables: Categorical (nominal or ordinal with a few categories)
-- Common Applications: Association between two categorical variables.


The chi-squared test tests the hypothesis that there is no relationship between two categorical variables. It compares the observed frequencies from the data with frequencies which would be expected if there was no relationship between the variables. We use a fisher test when the sample size is small.


Use the table(row variable $ column variable) function to parse the data
https://bookdown.org/kdonovan125/ibis_data_analysis_r4/working-with-tables-in-r.html 



Simple explanation from R website
https://bookdown.org/kdonovan125/ibis_data_analysis_r4/working-with-tables-in-r.html 

Determine if there is an assocation between the pollinator type and garden type (See data in Section 2)

### 6a: Fisher Test of Pollinator Data

```{r}
fisher.test(pollination_matrix)
```

### 6b: Chi.squared Test of Pollinator Data

```{r}
chisq.test(df$Pollinator, df$Garden_Type)
```

## 7 t-Test: Comparing Two Populations

T-tests are a type of inferential statistic used to determine statistical significance between the means of two variables. T-tests are used to test whether or not a hypothesis is statistically significant.

T-tests can be dependent or independent.

Comparing efficacy of different trial medications or treatments
To calculate a t-test, you need the mean values from each data set, the standard deviation, and how many data values there are.

https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/t.test 


### 7a: Perform a two-sample t-test to compare the means of the treatment and control groups.

We'll use the data from [Q1c: Create a vector of tree heights].

```{r}
t.test(tree_height, tree2_height)

```
The results of the t-test show that the p-value is not less than 0.05, which means that we can reject the null hypothesis that the means of the two groups are equal.

## 8. ANOVA: Comparing Three or More Populations

ANOVA (Analysis of Variance) in R is a statistical technique used to see how a quantitative dependent variable changed compared to categorical independent variables

[Link to Video: Analysis of Variance (ANOVA) in R](https://www.youtube.com/watch?v=qrP7evoNCy4)

(very helpful explanation) 

Helpful tips:

The summary() function provides an ANOVA table, which includes statistics such as the F-statistic, p-value, and degrees of freedom. These statistics help to determine whether the differences between group means are statistically significant.
You can use ANOVA to analyze data for your NSF experiment! Especially if you have different groups you are trying to compare and analyze
b) 
What is the ANOVA statistical test? Statistics 101: One-way ANOVA, A Visual Tutorial - YouTube
ANOVA stands for analysis of variance
It is used to categorize differences in data, or variances, into different groups for future statistical tests
A one-way ANOVA is for three or more groups of data
If there is no variance the ANOVA f-ratio will be 1

### Q8a: ANOVA for Compost Data

We can use anova(lm()) or an easier method: aov()
```{r}
compost.anova <- anova(lm(Dependent_Variable ~ Group, data=compost_data))
compost.aov <- aov(Dependent_Variable ~ Group, data=compost_data)

```

```{r}  
compost.anova
```

```{r}
summary(compost.aov)
```



## 9. Linear Regression

Answer: A linear regression model describes the relationship between a dependent variable, y, and one or more independent variables, X.

Q: What command in R allows you to review the models coefficients and see detailed information about the model

A:summary(lmheight) 

### Q9a: Linear Regression of Rainfall Data

Since we already found that a linear regression might be a good model to use from the scatterplot (Section [Q5e Scatterplot of Rainfall Data]), we can now run the linear regression.

we run the linear regression, let's loot at both the trend and nontrend:

```{r}
lm_notrend <- lm(rainfall_notrend ~ year, data = rainfall.df)
lm_trend <- lm(rainfall_trend ~ year, data = rainfall.df)

summary(lm_notrend)
summary(lm_trend)


```
The "Estimate" for the year, is the slope of the line and the p-value is the significance of the slope. In both cases, we cannot reject the null hypothesis that the slope is zero, i.e. there is no trend. 

How could we adjust the trend data to make it significant?


## 10. Logistic Regression

Logistic regression estimates the probability of an event occurring, such as voted or didn’t vote, based on a given data set of independent variables. They are used commonly for prediction and classification problems. They are best used in scenarios where there is a binary outcome (ie. yes or no, black of white, etc.)

Logistics regression graphs can be made with data sets that contain continuous variables (Like temperature, or depth) and a binary/ categorical outcome variable (yes/no , 1/0, on /off). Sample sizes are usually larger and assumes a linear relationship between variables and categorical outcomes. 

What is a logistic regression? Watch this 8 min video to find out!

### Q10a: Ground-Squirrel Reproduction with Logistic Regression

```{r}
logit_model <- glm(Off_spring ~ Weight, data = Ground_Squirrel_data, family = "binomial")
summary(logit_model)

```

### Q10b: Odds Ratio of Ground-Squirrel Reproduction

```{r}  
exp(coef(logit_model))

```

### Q10c: Predicting Ground-Squirrel Reproduction

```{r}

predict_sqirrel= sort(predict(logit_model, type = "response"))

plot(Ground_Squirrel_data$Weight, Ground_Squirrel_data$Off_spring, col = "blue", pch = 19)
lines(sort(Ground_Squirrel_data$Weight), predict_sqirrel, col = "red")

```

  
## 11. K-Means Clustering
  




