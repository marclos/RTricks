---
title: "Climate Change Project"
author: "Marc Los Huertos"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Updated: 2024-02-16


# Guide 1

## Chunk 1 Source Guide1fuctions

```{r, chunk1_1}
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide1functions.R")
```

## Chunk 2 Read Inventory
```{r, chunk1_2}
my.state = "OH"
filename.csv <- "/home/mwl04747/RTricks/04_Regional_Climate_Trends/stations.active.oldest.csv"
my.inventory <- readInventory.fun(filename.csv, my.state)
```

## Chunk 3 Download Stations
```{r, chunk1_3, results='hide'}
datapath = "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Data/SP24/"
downloadStations.fun(datapath, my.inventory)
```

# Guide 2

## Chunk 1 Source Guide1fuctions

```{r chunk2_1}
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide2functions.R")
```

## Chunk 2 Read Stations
```{r, chunk2_2}
datafolder = "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Data/SP24/"
ReadStations2.fun(datafolder)
```

## Chunk 3 Sort Stations --> Skip
```{r}
# sortstations.fun() Nor working yet. 
```

## Chunk 4 (Fix Date)
```{r, chunk2_4}
ls()
USC00331592a <- fixDates.fun(USC00331592)
USC00330563a <- fixDates.fun(USC00330563)
USC00330862a <- fixDates.fun(USC00330862)
USC00331072a <- fixDates.fun(USC00331072)
USC00332098a <- fixDates.fun(USC00332098)
USC00332791a <- fixDates.fun(USC00332791)
USC00333375a <- fixDates.fun(USC00333375)
USC00333758a <- fixDates.fun(USC00333758)
USC00333780a <- fixDates.fun(USC00333780)
USC00335438a <- fixDates.fun(USC00335438)
USC00336781a <- fixDates.fun(USC00336781)
USC00338609a <- fixDates.fun(USC00338609)
USC00338769a <- fixDates.fun(USC00338769)
USC00338822a <- fixDates.fun(USC00338822)
USC00338830a <- fixDates.fun(USC00338830)


```

## Chunk 5 Check Coverage
```{r, chunk2_5}
coverage.fun(USC00331592a)
coverage.fun(USC00330563a)
coverage.fun(USC00330862a)
coverage.fun(USC00331072a)
coverage.fun(USC00332098a)
coverage.fun(USC00332791a)
coverage.fun(USC00333375a)
coverage.fun(USC00333758a)
coverage.fun(USC00333780a)
coverage.fun(USC00335438a)
coverage.fun(USC00336781a)
coverage.fun(USC00338609a)
coverage.fun(USC00338769a)
coverage.fun(USC00338822a)
coverage.fun(USC00338830a)


```

## Chunk 6 Fix Values
```{r, chunk2_6}
USC00331592b <- fixValues.fun(USC00331592a)
USC00330563b <- fixValues.fun(USC00330563a)
USC00330862b <- fixValues.fun(USC00330862a)
USC00331072b <- fixValues.fun(USC00331072a)
USC00332098b <- fixValues.fun(USC00332098a)
USC00332791b <- fixValues.fun(USC00332791a)
USC00333375b <- fixValues.fun(USC00333375a)
USC00333758b <- fixValues.fun(USC00333758a)
USC00333780b <- fixValues.fun(USC00333780a)
USC00335438b <- fixValues.fun(USC00335438a)
USC00336781b <- fixValues.fun(USC00336781a)
USC00338609b <- fixValues.fun(USC00338609a)
USC00338769b <- fixValues.fun(USC00338769a)
USC00338822b <- fixValues.fun(USC00338822a)
USC00338830b <- fixValues.fun(USC00338830a)

```

## Chunk 7 QAQC
```{r, chunk2_7}
QAQC.fun(USC00042294b)
```

## Chunk 8 # Monthly Means and Normals
```{r, chunk2_8}
USC00331592.monthly <- MonthlyValues.fun(USC00331592b)
USC00331592.normals <- MonthlyNormals.fun(USC00331592b)

USC00330563.monthly <- MonthlyValues.fun(USC00330563b)
USC00330563.normals <- MonthlyNormals.fun(USC00330563b)

USC00330862.monthly <- MonthlyValues.fun(USC00330862b)
USC00330862.normals <- MonthlyNormals.fun(USC00330862b)

USC00331072.monthly <- MonthlyValues.fun(USC00331072b)
USC00331072.normals <- MonthlyNormals.fun(USC00331072b)

USC00332098.monthly <- MonthlyValues.fun(USC00332098b)
USC00332098.normals <- MonthlyNormals.fun(USC00332098b)

USC00332791.monthly <- MonthlyValues.fun(USC00332791b)
USC00332791.normals <- MonthlyNormals.fun(USC00332791b)

USC00333375.monthly <- MonthlyValues.fun(USC00333375b)
USC00333375.normals <- MonthlyNormals.fun(USC00333375b)

USC00333758.monthly <- MonthlyValues.fun(USC00333758b)
USC00333758.normals <- MonthlyNormals.fun(USC00333758b)

USC00333780.monthly <- MonthlyValues.fun(USC00333780b)
USC00333780.normals <- MonthlyNormals.fun(USC00333780b)

USC00335438.monthly <- MonthlyValues.fun(USC00335438b)
USC00335438.normals <- MonthlyNormals.fun(USC00335438b)

USC00336781.monthly <- MonthlyValues.fun(USC00336781b)
USC00336781.normals <- MonthlyNormals.fun(USC00336781b)

USC00338609.monthly <- MonthlyValues.fun(USC00338609b)
USC00338609.normals <- MonthlyNormals.fun(USC00338609b)

USC00338769.monthly <- MonthlyValues.fun(USC00338769b)
USC00338769.normals <- MonthlyNormals.fun(USC00338769b)

USC00338822.monthly <- MonthlyValues.fun(USC00338822b)
USC00338822.normals <- MonthlyNormals.fun(USC00338822b)

USC00338830.monthly <- MonthlyValues.fun(USC00338830b)
USC00338830.normals <- MonthlyNormals.fun(USC00338830b)


```


## Chunk 9 Anomalies
```{r, chunk2_9}
USC00331592.anomalies <- MonthlyAnomalies.fun(USC00331592.monthly, USC00331592.normals)
USC00330563.anomalies <- MonthlyAnomalies.fun(USC00330563.monthly, USC00330563.normals)
USC00330862.anomalies <- MonthlyAnomalies.fun(USC00330862.monthly, USC00330862.normals)
USC00331072.anomalies <- MonthlyAnomalies.fun(USC00331072.monthly, USC00331072.normals)
USC00332098.anomalies <- MonthlyAnomalies.fun(USC00332098.monthly, USC00332098.normals)
USC00332791.anomalies <- MonthlyAnomalies.fun(USC00332791.monthly, USC00332791.normals)
USC00333375.anomalies <- MonthlyAnomalies.fun(USC00333375.monthly, USC00333375.normals)
USC00333758.anomalies <- MonthlyAnomalies.fun(USC00333758.monthly, USC00333758.normals)
USC00333780.anomalies <- MonthlyAnomalies.fun(USC00333780.monthly, USC00333780.normals)
USC00335438.anomalies <- MonthlyAnomalies.fun(USC00335438.monthly, USC00335438.normals)
USC00336781.anomalies <- MonthlyAnomalies.fun(USC00336781.monthly, USC00336781.normals)
USC00338609.anomalies <- MonthlyAnomalies.fun(USC00338609.monthly, USC00338609.normals)
USC00338769.anomalies <- MonthlyAnomalies.fun(USC00338769.monthly, USC00338769.normals)
USC00338822.anomalies <- MonthlyAnomalies.fun(USC00338822.monthly, USC00338822.normals)
USC00338830.anomalies <- MonthlyAnomalies.fun(USC00338830.monthly, USC00338830.normals)


```



# Guide 3

## Chunk 1 Source Guide3fuctions

You might see a note about file not found, this is for Marc, you can ignore.
```{r, chunk3_1}
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide3functions.R")
```

## Chunk 2 Analyze for Trends by Month
```{r chunk3_2}
USC00331592.trends <- monthlyTrend.fun(USC00331592.anomalies)
USC00330563.trends <- monthlyTrend.fun(USC00330563.anomalies)
USC00330862.trends <- monthlyTrend.fun(USC00330862.anomalies)
USC00331072.trends <- monthlyTrend.fun(USC00331072.anomalies)
USC00332098.trends <- monthlyTrend.fun(USC00332098.anomalies)
USC00332791.trends <- monthlyTrend.fun(USC00332791.anomalies)
USC00333375.trends <- monthlyTrend.fun(USC00333375.anomalies)
USC00333758.trends <- monthlyTrend.fun(USC00333758.anomalies)
USC00333780.trends <- monthlyTrend.fun(USC00333780.anomalies)
USC00335438.trends <- monthlyTrend.fun(USC00335438.anomalies)
USC00336781.trends <- monthlyTrend.fun(USC00336781.anomalies)
USC00338609.trends <- monthlyTrend.fun(USC00338609.anomalies)
USC00338769.trends <- monthlyTrend.fun(USC00338769.anomalies)
USC00338822.trends <- monthlyTrend.fun(USC00338822.anomalies)
USC00338830.trends <- monthlyTrend.fun(USC00338830.anomalies)


```

## Chunk 3 TBD

Camille's Analysis

Let's find rank TMIN trends for each station. 
```{r}
library(dplyr)

USC00331592.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00330563.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00330862.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00331072.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00332098.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00332791.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00333375.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00333758.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00333780.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00335438.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00336781.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00338609.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00338769.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00338822.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)

USC00338830.trends %>%
  filter(ELEMENT == "TMIN") %>%
  filter(`Pr(>|t|)` < 0.05) %>%
  arrange(-Estimate)
```

## Suggestions for Next Steps

Create a dataframe with each of the stations' locations and the TMIN trend for June that includes the p-value and slope.

Then we create a map with the size of the point representing the magnitude of the trend and the color representing the p-value.



# Guide 4

## Chunk 1 Source Guide4functions

You might see a note about file note found, this is for Marc, you can ignore.
```{r chunk4_1}
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide4functions.R")
```

## Chunk 2 Plot Trend
```{r}
plotTrend2.fun(USC00042294.anomalies, "TMIN", 7)
```

almost done!


# Zip Files for Class

Marc's has created a function to zip all the costum functions and active stations file into a zip file for easy download/upload: Guidefunctions.zip.
```{r, echo=FALSE}
zip(zipfile = "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guidefunctions.zip", 
    files = c("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide1functions.R",
              "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide2functions.R",
              "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide3functions.R",
              "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide4functions.R",
              "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/MarcsTemplate.Rmd",
              "/home/mwl04747/RTricks/04_Regional_Climate_Trends/stations.active.oldest.csv"),
    flags= "-j")
```


# Putting it together 
```{r, eval=FALSE}
# Guide 1
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide1functions.R") # 1_1

my.state = "MT"
filename.csv <- "/home/mwl04747/RTricks/04_Regional_Climate_Trends/stations.active.oldest.csv" # 1_1
my.inventory <- readInventory.fun(filename.csv, my.state) # 1_2
datapath = "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Data/SP24/"
downloadStations.fun(datapath, my.inventory) # 1_3

# Guide 2
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide2functions.R") # 2_1

datafolder = "/home/mwl04747/RTricks/04_Regional_Climate_Trends/Data/SP24/"
ReadStations2.fun(datafolder) # 2_2

#station = 	USC00246918
#stationID = "USW00054797"

	
USC00246918a <- fixDates.fun(USC00246918) # 2_4
coverage.fun(USC00246918a) # 2_5
USC00246918b <- fixValues.fun(USC00246918a) # 2_6
QAQC.fun(USC00246918b) # 2_7
USC00246918.monthly <- MonthlyValues.fun(USC00246918b) # 2_8
USC00246918.normals <- MonthlyNormals.fun(USC00246918b) # 2_8

USC00246918.anomalies <- MonthlyAnomalies.fun(USC00246918.monthly, USC00246918.normals) # 2_9

# Guide 3
source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide3functions.R") # 3_1
USC00246918.trends <- monthlyTrend.fun(USC00246918.anomalies) # 3_2
plotTrend2.fun(USC00246918.anomalies, "TMIN", 7) # 4_2


#Guide 4
#source("/home/mwl04747/RTricks/04_Regional_Climate_Trends/Guides/Guide4functions.R") # 4_1

```

















